#!/usr/bin/env node

/**
 * Prueba de generaci√≥n de QR de WhatsApp
 */

import { io } from 'socket.io-client';

console.log('üß™ Probando generaci√≥n de QR de WhatsApp...');

// Conectar al servidor
const socket = io('http://localhost:5001', {
  transports: ['websocket'],
  timeout: 10000
});

socket.on('connect', () => {
  console.log('‚úÖ Conectado al servidor');
  
  // Solicitar QR (necesitar√°s un token JWT v√°lido)
  console.log('üì± Solicitando c√≥digo QR...');
  socket.emit('get-qr', { 
    token: 'test-token' // Reemplaza con un token real
  });
});

socket.on('qr-code', (qr) => {
  console.log('‚úÖ QR recibido!');
  console.log('   - Longitud:', qr.length, 'caracteres');
  console.log('   - Tipo: Imagen base64');
  
  // Guardar QR para visualizaci√≥n
  const html = `<!DOCTYPE html>
<html>
<head>
    <title>WhatsApp QR Test</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        img { max-width: 300px; border: 2px solid #25D366; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîê WhatsApp QR Code</h1>
    <img src="${qr}" alt="WhatsApp QR Code" />
    <p>Escanea este c√≥digo con WhatsApp</p>
</body>
</html>`;
  
  fs.writeFileSync('test-qr.html', html);
  console.log('   - QR guardado como: test-qr.html');
  console.log('   - Abre el archivo en tu navegador para escanear');
});

socket.on('whatsapp-connected', (data) => {
  console.log('‚úÖ WhatsApp conectado!');
  console.log('   - Usuario:', data.user);
  console.log('   - Tel√©fono:', data.phone);
});

socket.on('error', (error) => {
  console.error('‚ùå Error:', error);
});

socket.on('disconnect', () => {
  console.log('‚ùå Desconectado del servidor');
});

// Timeout despu√©s de 30 segundos
setTimeout(() => {
  console.log('‚è∞ Timeout alcanzado');
  socket.disconnect();
  process.exit(0);
}, 30000);
