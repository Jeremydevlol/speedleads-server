#!/usr/bin/env node

/**
 * Script para probar los endpoints de Instagram
 * Uso: node test-instagram-endpoints.js
 */

import axios from 'axios';

const BASE_URL = 'http://localhost:5001';

// Token de prueba (reemplaza con un token real)
const TEST_TOKEN = 'development-token'; // Para desarrollo local

async function testInstagramEndpoints() {
  console.log('üß™ Probando endpoints de Instagram...\n');
  
  const headers = {
    'Authorization': `Bearer ${TEST_TOKEN}`,
    'Content-Type': 'application/json'
  };
  
  try {
    // 1. Probar endpoint de estado
    console.log('1Ô∏è‚É£ Probando /api/instagram/status...');
    try {
      const statusResponse = await axios.get(`${BASE_URL}/api/instagram/status`, { headers });
      console.log('‚úÖ Status:', statusResponse.data);
    } catch (error) {
      console.log('‚ùå Error en status:', error.response?.data || error.message);
    }
    
    // 2. Probar endpoint de DMs
    console.log('\n2Ô∏è‚É£ Probando /api/instagram/dms...');
    try {
      const dmsResponse = await axios.get(`${BASE_URL}/api/instagram/dms`, { headers });
      console.log('‚úÖ DMs:', dmsResponse.data);
    } catch (error) {
      console.log('‚ùå Error en DMs:', error.response?.data || error.message);
      console.log('   Status:', error.response?.status);
      console.log('   Headers:', error.response?.headers);
    }
    
    // 3. Probar endpoint de comentarios
    console.log('\n3Ô∏è‚É£ Probando /api/instagram/comments...');
    try {
      const commentsResponse = await axios.get(`${BASE_URL}/api/instagram/comments`, { headers });
      console.log('‚úÖ Comments:', commentsResponse.data);
    } catch (error) {
      console.log('‚ùå Error en comments:', error.response?.data || error.message);
    }
    
    // 4. Probar endpoint de bot status
    console.log('\n4Ô∏è‚É£ Probando /api/instagram/bot/status...');
    try {
      const botStatusResponse = await axios.get(`${BASE_URL}/api/instagram/bot/status`, { headers });
      console.log('‚úÖ Bot Status:', botStatusResponse.data);
    } catch (error) {
      console.log('‚ùå Error en bot status:', error.response?.data || error.message);
    }
    
    // 5. Probar login (sin credenciales reales)
    console.log('\n5Ô∏è‚É£ Probando /api/instagram/login (sin credenciales)...');
    try {
      const loginResponse = await axios.post(`${BASE_URL}/api/instagram/login`, {
        username: 'test_user',
        password: 'test_password'
      }, { headers });
      console.log('‚úÖ Login:', loginResponse.data);
    } catch (error) {
      console.log('‚ùå Error en login:', error.response?.data || error.message);
    }
    
  } catch (error) {
    console.error('‚ùå Error general:', error.message);
  }
  
  console.log('\nüìã Resumen:');
  console.log('- Si ves errores 403, el problema es de autenticaci√≥n');
  console.log('- Si ves errores 400, el problema es de sesi√≥n de Instagram');
  console.log('- Si ves errores 500, el problema es del servidor');
  
  console.log('\nüîß Soluciones:');
  console.log('1. Verificar que el servidor est√© corriendo en puerto 5001');
  console.log('2. Verificar que el token de autenticaci√≥n sea v√°lido');
  console.log('3. Verificar que las variables de entorno est√©n configuradas');
  console.log('4. Verificar que las tablas de Instagram existan en Supabase');
}

// Ejecutar si se llama directamente
if (import.meta.url === `file://${process.argv[1]}`) {
  testInstagramEndpoints();
}

export default testInstagramEndpoints;

